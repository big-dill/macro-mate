// Wrap in a helper function so we can use django to create the URL in the template
function addTagify(apiUrl, maxResults) {
  // id_tags is generated by django
  var input = document.querySelector("#id_tags"),
    tagify = new Tagify(input, { whitelist: [] }),
    controller; // for aborting the call

  // listen to any keystrokes which modify tagify's input
  tagify.on("input", onInput);

  function onInput(e) {
    // reset the whitelist
    tagify.settings.whitelist.length = 0;
    // show loading animation and hide the suggestions dropdown
    tagify.loading(true).dropdown.hide.call(tagify);
    // get search_string from input
    var value = e.detail.value;

    // AJAX get request (shorthand)
    $.get({
      url: apiUrl,
      data: {
        // Use the value taken from the input
        search_string: value,
        max_results: maxResults,
      },
      dataType: "json",
    }).done(function(whitelist) {
      // update inwhitelist Array in-place
      tagify.settings.whitelist.splice(0, whitelist.length, ...whitelist);
      tagify.loading(false).dropdown.show.call(tagify, value); // render the suggestions dropdown
    });
  }
}
